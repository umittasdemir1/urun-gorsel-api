
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Ürün Görsel Sorgulama</title>
</head>
<body>
  <h2>Ürün Görsel Sorgulama</h2>
  <input type="text" id="barkodInput" placeholder="Barkod (13 hane)">
  <input type="text" id="kategoriInput" placeholder="Kategori (örn: gomlek)">
  <button onclick="sorgula()">Sorgula</button>
  <div id="result" style="margin-top:20px;"></div>

  <script>
    let products = [];

    // JSON verisini çek (GitHub linkin buraya gömülü)
    fetch("https://raw.githubusercontent.com/umittasdemir1/BMC/refs/heads/main/inventory_full_cleaned.json")
      .then(res => res.json())
      .then(data => {
        products = data;
      });

    function sorgula() {
      const barkod = document.getElementById("barkodInput").value.trim();
      const kategori = document.getElementById("kategoriInput").value.trim().toLowerCase();
      const resultDiv = document.getElementById("result");

      if (!/^[0-9]{13}$/.test(barkod)) {
        resultDiv.innerHTML = "<span style='color:red;'>⚠️ Barkod 13 haneli olmalıdır.</span>";
        return;
      }

      const match = products.find(p => p["Barkod"].trim() === barkod);
      if (!match) {
        resultDiv.innerHTML = `<span style='color:red;'>Barkod bulunamadı: ${barkod}</span>`;
        return;
      }

      const urunAdi = match["Ürün Adı"];
      const renk = match["Renk Açıklaması"];

      fetch("https://urun-gorsel-api.onrender.com", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          urun_adi: urunAdi,
          renk: renk,
          kategori: kategori
        })
      })
      .then(res => res.json())
      .then(data => {
        const imageTag = data.image_url && data.image_url !== "Bulunamadı"
          ? `<br><img src="${data.image_url}" style="max-width:100%; margin-top:10px;" />`
          : "<br><span style='color:gray;'>Görsel bulunamadı.</span>";

        resultDiv.innerHTML = `
          <strong>Ürün Adı:</strong> ${urunAdi}<br>
          <strong>Renk:</strong> ${renk}<br>
          <strong>Kategori:</strong> ${kategori}
          ${imageTag}
        `;
      })
      .catch(err => {
        resultDiv.innerHTML = `<span style='color:red;'>Hata oluştu: ${err.message}</span>`;
      });
    }
  </script>
</body>
</html>

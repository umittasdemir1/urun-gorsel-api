
<!DOCTYPE html>

<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Stok ve Ürün Bilgisi</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
    body {
  
  
  
  

      font-family: 'AvenirNext', sans-serif;
      margin: 0;
      padding: 0;
      
      
      
      
    }
    @media (min-width: 768px) {
      body {
  
  
  
  

        
      }
    }
    header {
  background-color: transparent;
  padding-top: 20px;
      text-align: center;
      background-color: transparent;
      padding: 32px 16px 24px 16px;
      
    }
    header img {
      max-width: 280px;
    }
    
    .qr-box {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
      position: relative;
    }
    .qr-box img {
      width: 60px;
      margin-bottom: 12px;
    }
    .qr-btns {
  display: flex;
  flex-direction: row;
  justify-content: center;
  gap: 10px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}
    .qr-btns button, .qr-btns label {
  flex: 1 1 45%;
  padding: 12px;
  font-size: 15px;
  background: #E0E0E0;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  text-align: center;
}
    .qr-btns button,
.qr-btns label,
input[type="text"],
.button-group button {
  width: 100%;
  padding: 12px;
  font-size: 15px;
  border-radius: 6px;
  box-sizing: border-box;
}

.qr-btns input[type="file"] {
      display: none;
    }
    #closeBtn {
  display: none;
  position: absolute;
  top: 10px;
  right: 10px;
  z-index: 999;
  width: 36px;
  height: 36px;
  border: none;
  background: transparent;
  padding: 0;
  display: none;
  align-items: center;
  justify-content: center;
}
    #reader {
  display: none;
  width: 100%;
  max-width: 360px;
  height: 260px;
  margin: 16px auto;
  border-radius: 12px;
  position: relative;
  background-color: #000;
  overflow: hidden;
}
.mask-layer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.55);
  z-index: 5;
}
.custom-frame {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 240px;
  height: 140px;
  transform: translate(-50%, -50%);
  z-index: 10;
  pointer-events: none;
}
.corner {
  position: absolute;
  width: 32px;
  height: 32px;
  border: 3px solid white;
  border-radius: 4px;
}
.top-left {
  top: 0;
  left: 0;
  border-right: none;
  border-bottom: none;
}
.top-right {
  top: 0;
  right: 0;
  border-left: none;
  border-bottom: none;
}
.bottom-left {
  bottom: 0;
  left: 0;
  border-right: none;
  border-top: none;
}
.bottom-right {
  bottom: 0;
  right: 0;
  border-left: none;
  border-top: none;
}
    input[type="text"] {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    .button-group {
      display: flex;
      gap: 10px;
    }
    .button-group button {
      flex: 1;
      padding: 12px;
      background: #E0E0E0;
      font-size: 16px;
      font-weight: 500;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #result {
      text-align: left;
      margin-top: 20px;
      font-size: 16px;
    }
  
main {
  max-width: 360px;
  margin-top: 40px;
  margin: 30px auto;
  padding: 20px;
  background-color: rgba(255,255,255,0.7); /* Saydamlık buraya taşındı */
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  text-align: center;
}


}

@media (max-width: 480px) {
  main {
    max-width: 260px;
    margin-top: 20px;
    padding: 16px;
    margin: 20px auto;
  }
}

  
body::before {
  content: "";
  background-image: url('https://images.pexels.com/photos/1974521/pexels-photo-1974521.jpeg');
  background-size: cover;
  background-position: center center;
  background-repeat: no-repeat;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: -1;
  opacity: 1;
  pointer-events: none;
}

  
    .reader-overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 10;
    }
    .reader-overlay::before {
      content: "";
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      clip-path: inset(20% 20% 20% 20%);
      z-index: 1;
    }
    .overlay-frame {
      position: absolute;
      top: 20%; left: 20%;
      width: 60%;
      height: 60%;
      z-index: 2;
      box-sizing: border-box;
    }
    .corner {
      position: absolute;
      width: 30px;
      height: 30px;
      border: 3px solid white;
    }
    .top-left { top: 0; left: 0; border-right: none; border-bottom: none; }
    .top-right { top: 0; right: 0; border-left: none; border-bottom: none; }
    .bottom-left { bottom: 0; left: 0; border-right: none; border-top: none; }
    .bottom-right { bottom: 0; right: 0; border-left: none; border-top: none; }

  </style>
</head>
<body>
<header>
<img alt="Bluemint Logo" src="bluemint_white_text_only.png" style="max-width: 360px;"/>
</header>
<main>
<h2>Stok ve Ürün Bilgisi</h2>
<div class="qr-box">
<img alt="QR Scan Icon" src="https://cdn-icons-png.flaticon.com/512/8250/8250041.png"/>
<div class="qr-btns">
<button onclick="startScanner()">Scan</button>
<label for="fileInput">Upload</label>
<input accept="image/*" id="fileInput" type="file"/>
<button id="closeBtn" onclick="stopScanner()">
<img alt="Kapat" src="https://cdn-icons-png.flaticon.com/512/463/463612.png" style="width: 20px; height: 20px;"/>
</button>
</div>
<div id="reader-container" style="position: relative; width: 100%; max-width: 300px; margin: 0 auto;">
  <div id="reader">
  <div class="mask-layer"></div>
  <div class="custom-frame">
    <span class="corner top-left"></span>
    <span class="corner top-right"></span>
    <span class="corner bottom-left"></span>
    <span class="corner bottom-right"></span>
  </div>
</div>
</div>
<input id="manualInput" maxlength="13" placeholder="Barkodu elle girin" type="text"/>
<div class="button-group">
<button onclick="manualSearch()">Sorgula</button>
<button onclick="clearInput()">Temizle</button>
</div>
<div id="result"></div>
</main>
<script>
    let html5QrCode;
    let isCameraActive = false;
    let products = [];
let lastScannedCode = "";
let lastScannedTime = 0;

    fetch("https://raw.githubusercontent.com/umittasdemir1/BMC/refs/heads/main/inventory_full_cleaned.json")
      .then(res => res.json())
      .then(data => products = data);

    function showResult(code) {
      const clean = code.trim();
  const now = Date.now();
  if (clean === lastScannedCode && now - lastScannedTime < 2000) return;
  lastScannedCode = clean;
  lastScannedTime = now;
      const resultDiv = document.getElementById("result");

const kategori = document.getElementById("kategoriInput").value.trim().toLowerCase().replace(/\s+/g, "-");
if (match && kategori) {
    const kod = match["Ürün Kodu"]?.trim();
    const renk = match["Renk Açıklaması"]?.trim()?.toLowerCase().replace(/\s+/g, "-");
    const url = `https://www.bluemint.com/images/thumbs/${kod}_${renk}_800.jpeg`;

    // Sonuç alanına ürün görselini ekle
    resultDiv.innerHTML += `<br><strong>Görsel:</strong><br><img src="${url}" alt="Ürün Görseli" style="margin-top:12px;max-width:100%;border-radius:8px;">`;
}

      const match = products.find(p => p["Barkod"].trim() === clean);
      document.getElementById("manualInput").value = clean;
  const beep = document.getElementById("beepSound");
  if (beep) {
    beep.currentTime = 0;
    beep.play().catch(e => console.warn("Ses çalınamadı:", e));
  }
      if (!/^[0-9]{13}$/.test(clean)) {
        resultDiv.innerHTML = "<span style='color:red;'>⚠️ Barkod 13 haneli olmalıdır.</span>";
        return;
      }
      resultDiv.innerHTML = match
        ? `<strong>Ürün Kodu:</strong> ${match["Ürün Kodu"]}<br>
           <strong>Ürün Adı:</strong> ${match["Ürün Adı"]}<br>
           <strong>Renk:</strong> ${match["Renk Açıklaması"]}<br>
           <strong>Beden:</strong> ${match["Beden"]}<br>
           <strong>Envanter:</strong> ${match["Envanter"]} Adet`
        : `<span style='color:red;'>Barkod bulunamadı: ${clean}</span>`;
    }

    async function startScanner() {
      const reader = document.getElementById("reader");
      reader.innerHTML = "";
      reader.style.display = "block";
      document.getElementById("closeBtn").style.display = "flex";
      reader.scrollIntoView({ behavior: "smooth" });

      if (!html5QrCode) html5QrCode = new Html5Qrcode("reader");

      const os = (function () {
        const ua = navigator.userAgent || navigator.vendor || window.opera;
        if (/android/i.test(ua)) return "Android";
        if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) return "iOS";
        return "Other";
      })();

      try {
        const cameras = await Html5Qrcode.getCameras();
        const backCam = cameras.find(c => c.label.toLowerCase().includes("back")) || cameras[0];

        const config = {
          fps: 10,
          qrbox: { width: "100%", height: "100%" },
          aspectRatio: 1.77778,
          experimentalFeatures: { useBarCodeDetectorIfSupported: true },
  showScanRegion: false,
          videoConstraints: {
            width: { ideal: 1280 },
            height: { ideal: 720 },
            facingMode: "environment"
          }
        };

        const cameraConfig = os === "iOS"
          ? { deviceId: backCam.id }
          : { facingMode: "environment" };

        setTimeout(async () => {
          await html5QrCode.start(cameraConfig, config, decoded => {
            if (/^[0-9]{13}$/.test(decoded)) {
              showResult(decoded);
              setTimeout(() => stopScanner(), 1500);
            }
          });
          isCameraActive = true;
        }, 500);
      } catch (err) {
        console.error("Kamera başlatılamadı:", err);
      }
    }

    async function stopScanner() {
      const reader = document.getElementById("reader");
      if (html5QrCode && isCameraActive) {
        await html5QrCode.stop();
        await html5QrCode.clear();
        isCameraActive = false;
      }
      reader.innerHTML = "";
      reader.style.display = "none";
      document.getElementById("closeBtn").style.display = "none";
      document.getElementById("closeBtn").style.display = "none";
    }

    async function scanFromFile(input) {
      const reader = document.getElementById("reader");
      if (isCameraActive) await stopScanner();
      reader.innerHTML = "";
      reader.style.display = "none";
      document.getElementById("closeBtn").style.display = "none";
      const file = input.files[0];
      if (!file) return;
      if (isCameraActive) await stopScanner();
      if (!html5QrCode) html5QrCode = new Html5Qrcode("reader");

      try {
        const result = await html5QrCode.scanFile(file, true);
        if (/^[0-9]{13}$/.test(result)) {
          showResult(result);
        }
      } catch {
        document.getElementById("result").innerText = "Dosyadan barkod okunamadı.";
      }

      input.value = null;
    }

    document.getElementById("fileInput").addEventListener("change", function () {
      scanFromFile(this);
    });

    function manualSearch() {
      showResult(document.getElementById("manualInput").value);
    }

    function clearInput() {
      document.getElementById("manualInput").value = '';
      document.getElementById("result").innerHTML = '';
    }

    document.getElementById("manualInput").addEventListener("input", function () {
      if (this.value.length > 13) this.value = this.value.slice(0, 13);
      if (this.value.length === 13) showResult(this.value);
    });
  </script>
<audio id="beepSound" preload="auto" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<audio id="errorSound" preload="auto" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"></audio>
</body>
</html>
